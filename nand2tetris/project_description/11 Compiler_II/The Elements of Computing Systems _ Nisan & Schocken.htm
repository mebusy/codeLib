<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0029)http://nand2tetris.org/11.php -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=windows-1252">
	<title>The Elements of Computing Systems / Nisan &amp; Schocken</title>
		<link rel="stylesheet" type="text/css" href="./The Elements of Computing Systems _ Nisan &amp; Schocken_files/style.css">
		<script type="text/javascript" src="./The Elements of Computing Systems _ Nisan &amp; Schocken_files/jquery-1.7.1.min.js"></script>		
		<script type="text/javascript" src="./The Elements of Computing Systems _ Nisan &amp; Schocken_files/popup.js"></script></head><body><div id="nand_popup" onmouseover="overPopup(true);" onmouseout="overPopup(false);" style="display: none; z-index: 200; top: 262px; left: 611px;"></div>		
	
	
		<div class="box">
					
				<a name="top"></a>
				<div class="topbar">
<img class="banner" src="./The Elements of Computing Systems _ Nisan &amp; Schocken_files/banner.png" height="100px" alt="Banner">
<span class="titletext">From NAND to Tetris</span>
<span class="subtitletext">Building a Modern Computer From First
Principles</span>
</div>
				<div class="sidemenu">
					<a href="http://nand2tetris.org/" class="menu">Home</a><a href="http://nand2tetris.org/course.php" class="menu_selected">Course</a><a href="http://nand2tetris.org/book.php" class="menu">Book</a><a href="http://nand2tetris.org/software.php" class="menu">Software</a><a href="http://nand2tetris.org/terms.php" class="menu">License</a><a href="http://nand2tetris.org/papers.php" class="menu">Papers</a><a href="http://nand2tetris.org/media.php" class="menu">Talks</a><a href="http://nand2tetris.org/coolstuff.php" class="menu">Cool Stuff</a><a href="http://nand2tetris.org/about.php" class="menu">About</a><a href="http://nand2tetris.org/team.php" class="menu">Team</a><a href="https://docs.google.com/forms/d/e/1FAIpQLSeGtR3QyvmjMubq3ij3h7CBKvDSxd9nnHhkLVZR4YB5FVo8sA/viewform" target="_blank" "="" class="menu">Stay in Touch</a><a href="http://questions-and-answers-forum.32033.n3.nabble.com/" target="_blank" "="" class="menu">Q&amp;A</a>				</div>
			<div class="content">
			<h1>Project 11: Compiler II - Code Generation</h1>
<span class="project_desc">Background</span>
<p class="project_text">
In this project we complete the construction of the Jack Compiler that we started building in the previous project. 
</p>

<span class="project_desc">Contract</span>
<p class="project_text">
Extend the <i>syntax analyzer</i> built in project 10 into a full-scale Jack compiler. The output of the compiler should be VM code designed to run on the virtual machine implemented in projects 7-8. Use your compiler to compile all the Jack programs listed below. Make sure that each translated program executes according to its documentation.
</p>

<span class="project_desc">Resources</span>
<p class="project_text">
The relevant reading for this project is book chapter 11. You will need two tools: the programming language with which you implement your compiler, and the supplied <i>VM emulator</i>, for testing the code generated by your compiler. All the test files necessary for this project are available in <span class="code">projects/11</span> on your computer.
</p>

<span class="project_desc">Proposed Implementation</span>
<p class="project_text">

</p><p class="project_text">
Chapter 11 includes a proposed, language-independent <i>Compiler API</i>, which can serve as your implementation's blueprint. The proposed implementation is based on morphing the syntax analyzer built in the previous project into a the full-scale compiler. In particular, we propose to gradually replace the software modules that generate XML output with software modules that generate VM code. This can be done in two main development stages, as follows. 
</p>

<u><b>Stage I: Symbol Table</b></u> <br> <br>

We suggest to start by building the compiler's symbol table module and using it to extend the syntax analyzer built in project 10. Presently, whenever an <i>identifier</i> is encountered in the source code, say <span class="code">foo</span>, the syntax analyzer outputs the XML line "<span class="code">&lt;identifier&gt; foo &lt;/identifier&gt;</span>". Instead, have your analyzer output the following information as part of its XML output (using some output format of your choice):

<ul>
    <li>The identifier's <i>name</i>, as done by the current version of the syntax analyzer.</li>
	<li>The identifier's <i>category</i>: <span class="code">var</span>, <span class="code">argument</span>, <span class="code">static</span>, <span class="code">field</span>, <span class="code">class</span>, or <span class="code">subroutine</span>.</li>

    <li> If the identifier's category is <span class="code">var</span>, <span class="code">argument</span>, <span class="code">static</span>, or <span class="code">field</span>, the <i>running index</i> assigned to the identifier by the symbol table.</li>
	<li> Whether the identifier is presently being <i>defined</i> (e.g. the identifier stands for a variable declared in a "<span class="code">var</span>" statement) or <i>used</i>. </li>
</ul>

You may test your symbol table module and the above capability by running your extended syntax analyzer on the test Jack programs supplied in project 10. Once the output of your extended syntax analyzer will include the above information, it means that you have developed a complete executable capability to understand the grammatical structure of Jack programs. At this stage you can make the switch to a full-scale compiler, and start generating VM code instead of XML output. This can be done by gradually morphing the code of the extended syntax analyzer into a full-scale compiler.

 <br> <br>
 
 <u><b>Stage II: Code Generation</b></u> <br> <br>

Since we gave many translation examples in chapter 11, we don't provide specific guidelines on how to develop the code generation features of the compiler. Rather, we provide a set of six application programs designed to unit-test these features incrementally. We strongly suggest to test your compiler on these programs in the given order. This way, you will be implicitly guided to build the compiler's code generation capabilities in stages, according to the unfolding demands of each test program.<br><br>

<b>Testing Method:</b> normally, when one compiles a program and runs into some problems, one concludes that the program is at fault. In this project though, the setting is exactly the opposite: all the Jack programs that we supply for testing purposes are error-free. Therefore, if their compilation yields any errors, it's the  <i>compiler</i> that you have to fix, not the test programs.

<br><br>
For each test program, go through the following routine:

<ol>
	<li>Compile the program directory using your compiler. This action should compile all the <span class="code">.jack</span> files in the directory into corresponding <span class="code">.vm</span> files;</li>
	<li>Inspect the generated <span class="code">.vm</span> files. If there are any visible problems, fix your compiler and go to step 1 (remember: all the supplied test programs are error-free);</li>
	<li>Test the translated VM program by loading the program directory into the supplied <i>VM emulator</i> and executing it using the "<i>no animation</i>" mode. Each one of the six test programs contains specific execution guidelines, as listed below; test the program according to these guidelines;</li>
	<li>If the test program behaves unexpectedly or some error message is displayed by the <i>VM emulator</i>, fix your compiler and go to to step 1.</li>
</ol>
<p></p>

<span class="project_desc">Testing</span>
<p class="project_text">Each of the programs listed below is designed to
gradually unit-test specific language handling capabilities of your
compiler.</p>
<table class="tests">
<tbody><tr class="tblheader"> 
	<td>Test Program</td>
	<td>Description</td>
	<td>Purpose</td>
</tr> 
<tr> 
	<td><u>Seven:</u><br><br> <a onmouseover="popup(&quot;projects/11/Seven/Main.jack&quot;,true);"> Main.jack </a>	</td>
	<td> Computes the value of <span class="code"> (3*2)+1 </span> and prints the result at the top left of the screen. To test if your compiler has translated the program correctly, run the translated code in the supplied <i>VM emulator</i> and make sure that it displays 7 correctly. </td>
	<td> Tests how your compiler handles a simple program containing three things: an arithmetic expression with integer constants (without variables), a <span class="code">do</span> statement, and a <span class="code">return</span> statement.</td>
</tr>

<tr> 
<td><u>Conversion to binary:</u><br><br> <a onmouseover="popup(&quot;projects/11/ConvertToBin/Main.jack&quot;,true);"> Main.jack </a> </td> 
<td>Unpacks a 16-bit number into its binary representation. The program takes the 16-bit value stored in <span class="code">RAM[8000]</span> and stores its individual bits in <span class="code">RAM[8001..8016]</span> (each location will contain 0 or 1). Before the conversion starts, the program initializes
<span class="code">RAM[8001..8016]</span> to <span class="code">-1</span>. To test if your compiler has translated the program correctly, load the translated code into the supplied <i>VM emulator</i> and go through the following routine:
<ul>
	<li>Put (interactively) some value in <span class="code">RAM[8000]</span>;</li>
	<li>Run the program for a few seconds, then stop its execution;</li>
	<li>Check (interactively) that <span class="code">RAM[8001..8016]</span>
contain the correct results, and that none of them contains <span class="code">-1</span>.</li>
</ul>
</td>
<td>Tests how your compiler handles all the procedural elements of the Jack language, i.e.  <i>expressions</i>, <i>functions </i>, and all the language <i>statements</i>. <br> <br> The program does not test the handling of <i>methods</i>, <i>constructors</i>, <i>arrays</i>, <i>strings</i>, <i>static variables</i> and <i>field variables</i>.  </td> 
</tr>

<tr>
<td><u>Square Dance:</u><br><br> 
<a onmouseover="popup(&quot;projects/11/Square/Main.jack&quot;,true);"> Main.jack </a>
<a onmouseover="popup(&quot;projects/11/Square/Square.jack&quot;,true);"> Square.jack </a> 
<a onmouseover="popup(&quot;projects/11/Square/SquareGame.jack&quot;,true);"> SquareGame.jack </a>
</td>
<td>A simple interactive "game", described in detail in project 9. The game enables moving a graphical square around the screen using the keyboard's four arrow keys. While moving, the size of the square can be increased / decreased by pressing the "z" and "x" keys, respectively. To quit the game, press the "q" key. To test if your compiler has translated the program correctly, run the translated code in the supplied <i>VM emulator</i> and make sure that it works according to the above description. </td>
<td>Tests how your compiler handles the object oriented constructs of the Jack language: <i>constructors</i>, <i>methods</i>, <i>fields</i> and expressions that include <i>method calls</i>. The program does not test the handling of <i>static variables</i>.</td>
</tr>

<tr>
<td><u>Average:</u><br><br>
<a onmouseover="popup(&quot;projects/11/Average/Main.jack&quot;,true);"> Main.jack </a>
</td>
<td>Computes the average of a user-supplied sequence of integers. To test if your compiler has translated the program correctly, run the translated code in the supplied <i>VM emulator</i> and follow the instructions displayed on the screen.</td>
<td>Tests how your compiler handles <i>arrays</i> and <i>strings</i>.</td>
</tr>
<tr>
<td><u>Pong:</u><br><br>
<a onmouseover="popup(&quot;projects/11/Pong/Main.jack&quot;,true);"> Main.jack </a> <br>
<a onmouseover="popup(&quot;projects/11/Pong/Ball.jack&quot;,true);"> Ball.jack </a> <br>
<a onmouseover="popup(&quot;projects/11/Pong/Bat.jack&quot;,true);"> Bat.jack </a> <br>
<a onmouseover="popup(&quot;projects/11/Pong/PongGame.jack&quot;,true);"> PongGame.jack </a> 
</td>
<td>In this classical game, a ball is moving randomly, bouncing off the screen "walls". The user can move a small paddle horizontally by pressing the keyboard's <i>left</i> and <i>right</i> arrow keys. Each time the paddle hits the ball, the user scores a point and the paddle shrinks a little, to make the game slightly more challenging. If the user misses and the ball hits the bottom, the game is over. To test if your compiler has translated this program correctly, run the translated code in the supplied <i>VM emulator</i> and play the game. Make sure to score some points, to test the part of the program that displays the score on the screen..</td>
<td>Provides a complete test of how your compiler handles <i>objects</i> and <i>static variables</i>.</td>
</tr>

<tr>
<td><u>Complex Arrays:</u><br><br><a onmouseover="popup(&quot;projects/11/ComplexArrays/Main.jack&quot;,true);"> Main.jack </a></td>
<td>Performs five complex calculations using arrays. For each such calculation, the program prints on the screen the expected result versus the actual result (as performed by the compiled program). To test if your compiler has translated the program correctly, run the translated code in the supplied <i>VM emulator</i> and make sure that the actual results are identical to the expected results.  </td>
<td>Tests how your compiler handles complex <i>array references</i> and <i>expressions</i>.  </td>
</tr>
</tbody></table>
			</div>
		</div>
		<div class="small">
			Best viewed with 
							<img src="./The Elements of Computing Systems _ Nisan &amp; Schocken_files/compatible_firefox.gif">
							<img src="./The Elements of Computing Systems _ Nisan &amp; Schocken_files/compatible_chrome.gif"><br>
			Designed and built by Tali Gutman ©
		</div>
	
	
</body></html>